- name: Read K8S cluster node VM configuration from file
  include_vars:
    file: vm.yml
    name: ubuntu
  tags: install
- name: Create keypair and cloud-init
  include_tasks: create-keys-and-cloudinit.yml
  tags: install
- name: Create the K3S cluster VMs
  tags: install
  include_tasks: delete-and-create-new-vm-tasks.yml
  vars:
    vmname: "{{ item.key }}"
    vmcreationparams: "{{ item.value }}"
  loop: "{{ ubuntu | dict2items }}"
- name: Generate artifcats yaml
  tags: install
  include_tasks: generate-artifacts.yml
  vars:
    IPv4: "{{vm_ip.stdout}}"
    VM_NAME: "{{vm_name.stdout }}"
    github_token: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          39346233343836636466373031336538333934333635363939356538613764666434383464373761
          6666646266363262626564323536663537613339396266380a306431646433393132663136353265
          31663733616536373464646263616632613166653365303734303137653861393831386462303431
          6237623433326630650a333538383963613766353636316235636537623263363035373439323131
          62383938626263646666313964663863376563323834623066636162363233373732346634353832
          6336393265373339653066626462393863383237633137653637
    docker_reg: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          62623766333561316235646133303266326531616661326534353862383938386161613831633061
          3139663835373132633831353234636436303138636230370a616162626532643538353437616132
          34633065313030656637623565363062343533323364643966356364343134343132353365643336
          3031383131663734300a303835343334656334376565383831623465366466323232353234626131
          6163
